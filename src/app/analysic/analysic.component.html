<app-navigation></app-navigation>

<section class="analytics-page">
  <mat-card class="mat-elevation-z4 p-4">
    <h2 class="page-title">Sales Analytics</h2>

    <div *ngIf="salesData.length > 0; else noData">
      <!-- Analytics Cards Section -->
      <div class="analytics-cards">
        <mat-card class="mat-elevation-z3 card">
          <mat-icon class="card-icon">attach_money</mat-icon>
          <strong>Total Sales:</strong>
          <div class="card-value">{{ totalSales | currency }}</div>
        </mat-card>

        <mat-card class="mat-elevation-z3 card">
          <mat-icon class="card-icon">show_chart</mat-icon>
          <strong>Total Profit:</strong>
          <div class="card-value">{{ totalProfit | currency }}</div>
        </mat-card>

        <mat-card class="mat-elevation-z3 card">
          <mat-icon class="card-icon">package</mat-icon>
          <strong>Items Sold:</strong>
          <div class="card-value">{{ totalItems }}</div>
        </mat-card>

        <mat-card class="mat-elevation-z3 card">
          <mat-icon class="card-icon">money_off</mat-icon>
          <strong>Avg. Cost per Item:</strong>
          <div class="card-value">{{ averageCost | currency }}</div>
        </mat-card>

        <mat-card class="mat-elevation-z3 card">
          <mat-icon class="card-icon">hourglass_empty</mat-icon>
          <strong>Pending Orders:</strong>
          <div class="card-value">{{ pendingCount }}</div>
        </mat-card>

        <mat-card class="mat-elevation-z3 card">
          <mat-icon class="card-icon">check_circle</mat-icon>
          <strong>Completed Orders:</strong>
          <div class="card-value">{{ doneCount }}</div>
        </mat-card>
      </div>
      <br>
      <!-- Add Filter Options for Status -->
      <div class="filter-options">
        <mat-button-toggle-group name="status" aria-label="Order Status Filter" [(ngModel)]="statusFilter" (change)="filterByStatus(statusFilter)">
          <mat-button-toggle value="Pending">Show Pending</mat-button-toggle>
          <mat-button-toggle value="Done">Show Completed</mat-button-toggle>
          <mat-button-toggle value="All">Show All</mat-button-toggle>
        </mat-button-toggle-group>
      </div>

      <!-- Filtered Sales Table -->
      <div *ngIf="filteredSalesData.length > 0">
        <mat-card class="mat-elevation-z4 p-4">
          <table mat-table [dataSource]="filteredSalesData" class="mat-elevation-z2 w-full">

            <ng-container matColumnDef="client">
              <th mat-header-cell *matHeaderCellDef> Client </th>
              <td mat-cell *matCellDef="let element"> {{ element.client }} </td>
            </ng-container>

            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef> Quantity </th>
              <td mat-cell *matCellDef="let element"> {{ element.quantity }} </td>
            </ng-container>

            <ng-container matColumnDef="cost">
              <th mat-header-cell *matHeaderCellDef> Cost </th>
              <td mat-cell *matCellDef="let element"> {{ element.cost }} </td>
            </ng-container>

            <ng-container matColumnDef="discount">
              <th mat-header-cell *matHeaderCellDef> Discount (%) </th>
              <td mat-cell *matCellDef="let element"> {{ element.discount }} </td>
            </ng-container>

            <ng-container matColumnDef="delivery">
              <th mat-header-cell *matHeaderCellDef> Delivery </th>
              <td mat-cell *matCellDef="let element"> {{ element.delivery }} </td>
            </ng-container>

            <ng-container matColumnDef="shippingCost">
              <th mat-header-cell *matHeaderCellDef> Shipping </th>
              <td mat-cell *matCellDef="let element"> {{ element.shippingCost }} </td>
            </ng-container>

            <ng-container matColumnDef="choice">
              <th mat-header-cell *matHeaderCellDef> Choice </th>
              <td mat-cell *matCellDef="let element"> {{ element.choice }} </td>
            </ng-container>

            <ng-container matColumnDef="profit">
              <th mat-header-cell *matHeaderCellDef> Profit </th>
              <td mat-cell *matCellDef="let element"> {{ calculateProfit(element) | currency }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['client', 'quantity', 'cost', 'discount', 'delivery', 'shippingCost', 'choice', 'profit']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['client', 'quantity', 'cost', 'discount', 'delivery', 'shippingCost', 'choice', 'profit'];"></tr>
          </table>
        </mat-card>
      </div>
    </div>

    <ng-template #noData>
      <mat-card class="mat-elevation-z3 p-4">
        <p class="no-data-msg">ðŸš« No sales data available.</p>
      </mat-card>
    </ng-template>
  </mat-card>
</section>
